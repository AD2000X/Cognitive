<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cognitive Structure Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script>
    console.log("Plotly version:", Plotly.version);
    </script>
    <style>
        .slider-container {
            margin-bottom: 10px;
        }
        #plot {
            width: 100%;
            height: 500px;
        }
    </style>
</head>
<body>
    <h1>Cognitive Structure Dashboard</h1>

    <div class="slider-container">
        <label for="age">Age:</label>
        <input type="range" id="age" min="18" max="80" value="64">
        <span id="ageValue">64</span>
    </div>

    <div class="slider-container">
        <label for="iq">IQ:</label>
        <input type="range" id="iq" min="70" max="130" value="109">
        <span id="iqValue">109</span>
    </div>

    <div class="slider-container">
        <label for="PL">PL:</label>
        <input type="number" id="PL" value="100">
    </div>

    <div class="slider-container">
        <label for="PR">PR:</label>
        <input type="number" id="PR" value="100">
    </div>

    <div class="slider-container">
        <label for="SE">SE:</label>
        <input type="number" id="SE" value="100">
    </div>

    <div class="slider-container">
        <label for="CT">CT:</label>
        <input type="number" id="CT" value="100">
    </div>

    <div class="slider-container">
        <label for="AT">AT:</label>
        <input type="number" id="AT" value="100">
    </div>

    <div class="slider-container">
        <label for="ABPM">ABPM:</label>
        <input type="number" id="ABPM" value="100">
    </div>

    <div class="slider-container">
        <label for="EBPM">EBPM:</label>
        <input type="number" id="EBPM" value="100">
    </div>

    <div class="slider-container">
        <label for="TBPM">TBPM:</label>
        <input type="number" id="TBPM" value="100">
    </div>

    <div class="slider-container">
        <label for="AV">AV:</label>
        <input type="number" id="AV" value="100">
    </div>

    <button onclick="updateGraph()">Update Chart</button>

    <div id="plot"></div>

    <script>
    function updateGraph() {
        const data = {
            age: document.getElementById('age').value,
            iq: document.getElementById('iq').value,
            PL: document.getElementById('PL').value,
            PR: document.getElementById('PR').value,
            SE: document.getElementById('SE').value,
            CT: document.getElementById('CT').value,
            AT: document.getElementById('AT').value,
            ABPM: document.getElementById('ABPM').value,
            EBPM: document.getElementById('EBPM').value,
            TBPM: document.getElementById('TBPM').value,
            AV: document.getElementById('AV').value
        };

        fetch('/process', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        })
        .then(response => response.json())
        .then(data => {
            console.log("Received data:", data);
            if (data.plot_data && data.layout) {
                console.log("Attempting to plot");
                Plotly.newPlot('plot', data.plot_data, data.layout)
                    .then(() => console.log("Plot successful"))
                    .catch(err => console.error("Plot error:", err));
            } else {
                console.error("Invalid data structure received");
            }
        })
        .catch(error => console.error('Fetch error:', error));
    }

    // Update slider value display
    document.getElementById('age').oninput = function() {
        document.getElementById('ageValue').textContent = this.value;
    }
    document.getElementById('iq').oninput = function() {
        document.getElementById('iqValue').textContent = this.value;
    }

    // Load chart initially
    updateGraph();
    </script>
</body>
</html>
